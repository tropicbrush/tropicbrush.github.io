<html class="h-100">
   <head>
      <meta charset="UTF-8" />
      <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
     
      <title>Auth0 Login Using SPA SDK</title>
      <link
         rel="stylesheet"
         href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
         />
      
      <link
         rel="stylesheet"
         href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/monokai-sublime.min.css"
         />
      <link
         rel="stylesheet"
         href="https://use.fontawesome.com/releases/v5.7.2/css/solid.css"
         integrity="sha384-r/k8YTFqmlOaqRkZuSiE9trsrDXkh07mRaoGBMoDcmA58OHILZPsk29i2BsFng1B"
         crossorigin="anonymous"
         />
      <link
         rel="stylesheet"
         href="https://use.fontawesome.com/releases/v5.7.2/css/fontawesome.css"
         integrity="sha384-4aon80D8rXCGx9ayDt85LbyUHeMWd3UiBaWliBlJ53yzm9hqN21A+o1pqoyK04h+"
         crossorigin="anonymous"
         />

      <link
         rel="stylesheet"
         href="public/css/main.css"
         />
      
       
       
       
   </head>
<body class="h-100">
	   
      <div id="app" class="flex-grow-1 d-flex flex-column">
         <div class="nav-container">
            <nav class="navbar navbar-expand-md navbar-light bg-light">
               <div class="container">
                  <div class="navbar-brand logo"></div>
                  <button
                     class="navbar-toggler"
                     type="button"
                     data-toggle="collapse"
                     data-target="#navbarNav"
                     aria-controls="navbarNav"
                     aria-expanded="false"
                     aria-label="Toggle navigation"
                     >
                  <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarNav">
                     <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                           <a href="/" class="route-link btn btn-primary btn-margin">Home</a>
                        </li>
	
                     </ul>
                   
                  </div>
               </div>
            </nav>
         </div>
          
 <div id="main-content">
            <div id="content-home" class="page">
		   
               <div class="container form-options">
        <h2>Private Key/Public Key:</h2>
        
        <div class="form-options">
        <button onclick="generateAndDisplayKeys()">Generate Keys</button>
	<div class="form-options">
	<label for="private-key"><b>Private Key</b></label>
        <div id="private-key"></div>
        </div>
        <div class="form-options">
	<label for="public-key"><b>Public Key</b></label>
        <div id="public-key"></div>
        </div>
        <button onclick="downloadPublicKey()">Download Public Key</button>
        <button onclick="downloadPrivateKey()">Download Private Key</button>
            </div>
    </div>
</div>
               </div>
    <script>
        // Generate key pair
        async function generateKeyPair() {
            try {
                // Generate RSA key pair
                const keyPair = await window.crypto.subtle.generateKey(
                    {
                        name: "RSA-OAEP", // Using RSA with Optimal Asymmetric Encryption Padding
                        modulusLength: 2048, // 2048-bit key length
                        publicExponent: new Uint8Array([0x01, 0x00, 0x01]), // Exponent value (65537)
                        hash: { name: "SHA-256" }, // SHA-256 hashing algorithm
                    },
                    true, // Whether the key is extractable (we need to export it)
                    ["encrypt", "decrypt"] // Key usage
                );

                // Export public key
                const publicKey = await window.crypto.subtle.exportKey(
                    "spki", // Format: SubjectPublicKeyInfo (SPKI)
                    keyPair.publicKey
                );

                // Export private key
                const privateKey = await window.crypto.subtle.exportKey(
                    "pkcs8", // Format: PrivateKeyInfo (PKCS8)
                    keyPair.privateKey
                );

                return { publicKey, privateKey };
            } catch (error) {
                console.error("Key pair generation error:", error);
            }
        }

        // Convert public key from SPKI to PEM format
        function spkiToPem(spkiArray) {
            const base64Key = btoa(String.fromCharCode.apply(null, new Uint8Array(spkiArray)));
            return `-----BEGIN PUBLIC KEY-----\n${base64Key}\n-----END PUBLIC KEY-----`;
        }

        // Function to download the public key
        function downloadPublicKey() {
            const publicKeyContent = document.getElementById("public-key").textContent;
            downloadKey(publicKeyContent, "public_key.pem");
        }

        // Function to download the private key
        function downloadPrivateKey() {
            const privateKeyContent = document.getElementById("private-key").textContent;
            downloadKey(privateKeyContent, "private_key.txt");
        }

        // Helper function to trigger download of key content
        function downloadKey(content, filename) {
            const element = document.createElement("a");
            element.setAttribute("href", "data:text/plain;charset=utf-8," + encodeURIComponent(content));
            element.setAttribute("download", filename);
            element.style.display = "none";
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        // Update HTML content with generated keys and store in sessionStorage
        async function updateKeys() {
            const { publicKey, privateKey } = await generateKeyPair();
            const pemPublicKey = spkiToPem(publicKey);
            const base64PrivateKey = btoa(String.fromCharCode.apply(null, new Uint8Array(privateKey)));
            document.getElementById("public-key").textContent = pemPublicKey;
            document.getElementById("private-key").textContent = base64PrivateKey;

            // Store keys in sessionStorage
            sessionStorage.setItem("publicKey", pemPublicKey);
            sessionStorage.setItem("privateKey", base64PrivateKey);
        }

        // Function to generate and display keys
        async function generateAndDisplayKeys() {
            await updateKeys();
        }
    </script>
</body>
</html>
